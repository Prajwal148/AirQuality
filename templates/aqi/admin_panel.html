<!-- templates/aqi/admin_panel.html -->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Admin Panel – AirWatch</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
      :root{
        --accent:#007aff; --accent-strong:#005fcc;
        --text:#222; --muted:#555; --border:#e5e7eb; --card:#fff;
        --bg1:#eef2f3; --bg2:#ffffff;
        --chip-bg:#f8fafc; --chip-ink:#1f2937;
      }

      /* Base */
      *{box-sizing:border-box}
      body{
        margin:0; color:var(--text);
        font-family:"Inter",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Arial,sans-serif;
        background:linear-gradient(135deg,var(--bg1),var(--bg2));
      }
      a{ color:var(--accent); text-decoration:none }
      a:hover{ text-decoration:underline }

      /* Header */
      header{
        position:sticky; top:0; z-index:10;
        display:flex; justify-content:space-between; align-items:center;
        padding:1rem 1.25rem; background:#ffffffc7;
        backdrop-filter:blur(8px); box-shadow:0 2px 10px rgba(0,0,0,.08);
        border-radius:0 0 12px 12px;
      }
      header .brand{ font-weight:600; color:var(--accent) }

      .btn{
        background:var(--accent); color:#fff !important; text-decoration:none;
        padding:.6rem 1rem; border-radius:8px; font-weight:600; border:0; cursor:pointer;
        transition:all .2s ease; box-shadow:0 6px 18px rgba(0,122,255,.18);
        display:inline-flex; align-items:center; gap:.4rem;
      }
      .btn:hover{ background:var(--accent-strong); transform:translateY(-1px) }

      /* Layout */
      .wrap{ max-width:1000px; margin:32px auto 40px; padding:0 16px }
      .card{
        background:var(--card); border:1px solid var(--border);
        border-radius:16px; box-shadow:0 6px 24px rgba(0,0,0,.08);
        padding:20px; margin-bottom:16px;
      }
      h1{ margin:.25rem 0 1rem }
      h3{ margin:.25rem 0 .75rem }

      /* Forms */
      form .row{ display:flex; gap:10px; align-items:flex-end; flex-wrap:wrap }
      label{ font-weight:600; color:#333; margin-bottom:.4rem; display:block }
      select, input[type="text"], input[type="number"]{
        width:100%; padding:.6rem .7rem; border:1px solid var(--border); border-radius:10px;
        background:#fff; color:var(--text);
      }
      select:focus, input:focus{ outline:none; border-color:var(--accent); box-shadow:0 0 0 3px rgba(0,122,255,.15) }

      .actions{ display:flex; gap:.6rem; flex-wrap:wrap }
      .messages{ margin-top:8px }
      .messages p{
        margin:.35rem 0; padding:.5rem .75rem; border-radius:8px; border:1px solid var(--border);
        background:#f8fafc; color:var(--muted);
      }
      .messages .success{ background:#d1fae5; border-color:#6ee7b7; color:#065f46 }
      .messages .error{ background:#fee2e2; border-color:#fecaca; color:#991b1b }

      /* Visibility grid */
      fieldset{
        border:1px solid var(--border); border-radius:12px; padding:12px; margin:10px 0 14px;
      }
      .grid{
        display:grid; grid-template-columns:1fr 1fr; gap:10px;
      }
      @media (min-width:900px){ .grid{ grid-template-columns:repeat(3,1fr) } }

      /* ---------- Fancy checkbox chips (works with existing markup) ---------- */
      .check{
        position:relative;
        display:flex; align-items:center; gap:.65rem;
        padding:.65rem .9rem .65rem .85rem;
        border:1px solid var(--border); border-radius:12px;
        background:var(--chip-bg); color:var(--chip-ink);
        cursor:pointer; user-select:none;
        transition:transform .12s ease, box-shadow .18s ease, border-color .18s ease, background .18s ease;
      }
      .check:hover{ transform:translateY(-1px); box-shadow:0 6px 16px rgba(0,0,0,.06) }

      /* Left accent bar */
      .check::before{
        content:""; width:6px; height:18px; border-radius:4px;
        background:#cbd5e1; flex:0 0 auto;
      }

      /* Hide native box but keep it accessible */
      .check input[type="checkbox"]{
        position:absolute; inset:0; margin:0; opacity:0; cursor:pointer;
      }

      /* Checkmark icon */
      .check::after{
        content:""; width:18px; height:18px; border-radius:999px;
        border:1px solid #cbd5e1; background:#fff;
        flex:0 0 auto; margin-left:auto;
        transition:all .18s ease;
        /* Check glyph via mask */
        -webkit-mask: none; mask: none;
      }
      /* Draw a check when checked using background + mask */
      .check:has(input:checked)::after{
        background: var(--accent);
        border-color: var(--accent);
        -webkit-mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="%23fff"><path d="M20.285 6.709a1 1 0 0 1 0 1.414l-9.192 9.192a1 1 0 0 1-1.414 0L3.715 12.55a1 1 0 1 1 1.414-1.414l5.138 5.138 8.485-8.485a1 1 0 0 1 1.533-.08z"/></svg>') center/12px 12px no-repeat;
                mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="white" d="M20.285 6.709a1 1 0 0 1 0 1.414l-9.192 9.192a1 1 0 0 1-1.414 0L3.715 12.55a1 1 0 1 1 1.414-1.414l5.138 5.138 8.485-8.485a1 1 0 0 1 1.533-.08z"/></svg>') center/12px 12px no-repeat;
        background-blend-mode: normal;
      }

      /* Checked state styling */
      .check:has(input:checked){
        border-color: var(--accent);
        background: #eaf2ff;
        box-shadow: 0 8px 20px rgba(0,122,255,.12);
        color:#0f172a;
      }
      .check:has(input:checked)::before{ background: var(--accent) }

      /* Keyboard focus ring */
      .check:has(input:focus-visible){
        outline: 3px solid rgba(0,122,255,.25);
        outline-offset: 2px;
      }

      /* Disabled state (if any) */
      .check:has(input[disabled]){
        opacity:.55; cursor:not-allowed; filter:grayscale(.1);
      }
      /* --------------------------------------------------------------------- */
    </style>
  </head>

  <body>
    <header>
      <div class="brand">AirWatch – Admin Panel</div>
      <nav style="display:flex; gap:.6rem; align-items:center;">
        <a class="btn" href="{% url 'landing' %}">Home</a>
        <form action="{% url 'logout' %}" method="post" style="display:inline;">
  {% csrf_token %}
  <button class="btn" type="submit">Logout</button>
</form>

      </nav>
    </header>

    <div class="wrap">
      <h1>Admin Panel</h1>

      <!-- Select user -->
      <section class="card">
        <h3>Select a user</h3>
        <form method="post">
          {% csrf_token %}
          <div class="row">
            <div style="flex:1 1 320px;">
              {{ select_form.user.label_tag }}
              {{ select_form.user }}
            </div>
            <div class="actions">
              <button type="submit" name="select_user" class="btn">Load</button>
            </div>
          </div>
        </form>
      </section>

      {% if selected_user %}
      <!-- Visibility controls -->
      <section class="card">
        <h3>Visibility for {{ selected_user.username }}</h3>
        <form method="post">
          {% csrf_token %}
          {{ select_form.user.as_hidden }}
          <fieldset>
            <div class="grid">
              <label class="check">{{ vis_form.can_pm2_5 }} PM2.5</label>
              <label class="check">{{ vis_form.can_pm10 }} PM10</label>
              <label class="check">{{ vis_form.can_o3 }} Ozone (O₃)</label>
              <label class="check">{{ vis_form.can_co }} CO</label>
              <label class="check">{{ vis_form.can_no2 }} NO₂</label>
              <label class="check">{{ vis_form.can_so2 }} SO₂</label>
              <label class="check">{{ vis_form.can_aqi }} Show AQI tile</label>
            </div>
          </fieldset>
          <div class="actions">
            <button type="submit" name="save_visibility" class="btn">Save</button>
          </div>
        </form>
      </section>
      {% endif %}

      <div class="messages">
        {% for message in messages %}
          <p class="{% if message.tags %}{{ message.tags }}{% endif %}">{{ message }}</p>
        {% endfor %}
      </div>

      <p style="margin-top:8px;"><a href="{% url 'landing' %}">← Back to Home</a></p>
    </div>
  </body>
</html>
